# „K„p„{ „y„ƒ„„€„|„„x„€„r„p„„„ TensorFlow 2.0?

Note: „B„ƒ„‘ „y„~„†„€„‚„}„p„ˆ„y„‘ „r „„„„€„} „‚„p„x„t„u„|„u „„u„‚„u„r„u„t„u„~„p „ƒ „„€„}„€„‹„„ „‚„…„ƒ„ƒ„{„€„s„€„r„€„‚„‘„‹„u„s„€
Tensorflow „ƒ„€„€„q„‹„u„ƒ„„„r„p „~„p „€„q„‹„u„ƒ„„„r„u„~„~„„‡ „~„p„‰„p„|„p„‡. „P„€„ƒ„{„€„|„„{„… „„„„€„„ „„u„‚„u„r„€„t „~„u
„‘„r„|„‘„u„„„ƒ„‘ „€„†„y„ˆ„y„p„|„„~„„}, „}„ „~„u „s„p„‚„p„~„„„y„‚„…„u„} „‰„„„€ „€„~ „~„p 100% „p„{„{„…„‚„p„„„u„~ „y „ƒ„€„€„„„r„u„„„ƒ„„„r„…„u„„
[„€„†„y„ˆ„y„p„|„„~„€„z „t„€„{„…„}„u„~„„„p„ˆ„y„y „~„p „p„~„s„|„y„z„ƒ„{„€„} „‘„x„„{„u](https://www.tensorflow.org/?hl=en).
„E„ƒ„|„y „… „r„p„ƒ „u„ƒ„„„ „„‚„u„t„|„€„w„u„~„y„u „{„p„{ „y„ƒ„„‚„p„r„y„„„ „„„„€„„ „„u„‚„u„r„€„t, „}„ „q„…„t„u„} „€„‰„u„~„ „‚„p„t„
„…„r„y„t„u„„„ pull request „r [tensorflow/docs](https://github.com/tensorflow/docs)
„‚„u„„€„x„y„„„€„‚„y„z GitHub. „E„ƒ„|„y „r„ „‡„€„„„y„„„u „„€„}„€„‰„ „ƒ„t„u„|„p„„„ „t„€„{„…„}„u„~„„„p„ˆ„y„ „„€ Tensorflow
„|„…„‰„Š„u („ƒ„t„u„|„p„„„ „ƒ„p„} „„u„‚„u„r„€„t „y„|„y „„‚„€„r„u„‚„y„„„ „„u„‚„u„r„€„t „„€„t„s„€„„„€„r„|„u„~„~„„z „{„u„}-„„„€ „t„‚„…„s„y„}),
„~„p„„y„Š„y„„„u „~„p„} „~„p
[docs-ru@tensorflow.org list](https://groups.google.com/a/tensorflow.org/forum/#!forum/docs-ru).

„B TensorFlow 2.0 „q„„|„y „ƒ„t„u„|„p„~„ „~„u„ƒ„{„€„|„„{„€ „y„x„}„u„~„u„~„y„z, „{„€„„„€„‚„„u „„€„x„r„€„|„‘„„ „r„ƒ„u„} „„€„|„„x„€„r„p„„„u„|„‘„} TensorFlow 
„‚„p„q„€„„„p„„„ „q„€„|„u„u „„‚„€„t„…„{„„„y„r„~„€. „B TensorFlow 2.0 „q„„|„y „…„t„p„|„u„~„
[„~„u„~„…„w„~„„u API](https://github.com/tensorflow/community/blob/master/rfcs/20180827-api-names.md),
„ƒ„…„‹„u„ƒ„„„r„…„„‹„y„u „y „y„ƒ„„€„|„„x„…„u„}„„u API „q„„|„y „„‚„€„‚„p„q„€„„„p„~„ 
([„€„q„Œ„u„t„y„~„u„~„ RNN](https://github.com/tensorflow/community/blob/master/rfcs/20180920-unify-rnn-interface.md),
[„p „„„p„{„w„u „€„„„„y„}„y„x„p„„„€„‚„](https://github.com/tensorflow/community/blob/master/rfcs/20181016-optimizer-unification.md)),
„…„|„…„‰„Š„u„~„p „y„~„„„u„s„‚„p„ˆ„y„‘ „ƒ „‚„p„q„€„‰„u„z „ƒ„‚„u„t„€„z Python „r „‚„u„w„y„}„u
[Eager execution](https://www.tensorflow.org/guide/eager).

„B„€ „}„~„€„s„y„‡
[„x„p„„‚„€„ƒ„p„‡ RFC](https://github.com/tensorflow/community/pulls?utf8=%E2%9C%93&q=is%3Apr)
„€„q„Œ„‘„ƒ„~„‘„|„y„ƒ„ „€„ƒ„~„€„r„~„„u „y„x„}„u„~„u„~„y„‘, „{„€„„„€„‚„„u „x„p„„„‚„€„~„…„„ TensorFlow 2.0. „B „„„„€„} „t„€„{„…„}„u„~„„„u
„q„…„t„u„„ „„€„{„p„x„p„~„€, „{„p„{ „t„€„|„w„u„~ „r„„s„|„‘„t„u„„„ „„‚„€„ˆ„u„ƒ„ƒ „‚„p„q„€„„„ „ƒ „~„€„r„„} TensorFlow 2.0.
„P„€„t„‚„p„x„…„}„u„r„p„u„„„ƒ„‘, „‰„„„€ „r„ „…„w„u „x„~„p„{„€„}„ „ƒ TensorFlow 1.x.

## „K„‚„p„„„{„y„z „ƒ„„y„ƒ„€„{ „€„ƒ„~„€„r„~„„‡ „y„x„}„u„~„u„~„y„z

### „X„y„ƒ„„„{„p API

„M„~„€„s„y„u API „q„„|„y „|„y„q„€
[„…„t„p„|„u„~„, „|„y„q„€ „„u„‚„u„}„u„‹„u„~„](https://github.com/tensorflow/community/blob/master/rfcs/20180827-api-names.md)
„r TF 2.0. „R„p„}„„}„y „{„‚„…„„~„„}„y „y„x„}„u„~„u„~„y„‘„}„y „‘„r„|„‘„„„„ƒ„‘ „…„t„p„|„u„~„y„u `tf.app`, `tf.flags`, „p „„„p„{„w„u
`tf.logging` „r „„€„|„„x„… „~„€„r„€„z „q„y„q„|„y„€„„„u„{„y „ƒ „€„„„{„‚„„„„„} „y„ƒ„‡„€„t„~„„} „{„€„t„€„}
[absl-py](https://github.com/abseil/abseil-py), „„u„‚„u„}„u„‹„u„~„y„u „„‚„€„u„{„„„€„r, „{„€„„„€„‚„„u „q„„|„y „r
`tf.contrib`, „p „„„p„{„w„u „‰„y„ƒ„„„{„p „€„ƒ„~„€„r„~„€„s„€ „y„}„u„~„y `tf.*`: „‚„u„t„{„€ „y„ƒ„„€„|„„x„…„u„}„„u „†„…„~„{„ˆ„y„y 
„q„„|„y „€„q„Œ„u„t„y„~„u„~„ „r „€„„„t„u„|„„~„„u „}„€„t„…„|„y, „~„p„„‚„y„}„u„‚ `tf.math`. „N„u„{„€„„„€„‚„„u API „q„„|„y „x„p„}„u„~„u„~„
„y„‡ 2.0 „„{„r„y„r„p„|„u„~„„„p„}„y - `tf.summary`, `tf.keras.metrics`, „y
`tf.keras.optimizers`. „R„p„}„„z „„‚„€„ƒ„„„€„z „ƒ„„€„ƒ„€„q „p„r„„„€„}„p„„„y„‰„u„ƒ„{„y „„u„‚„u„y„}„u„~„€„r„p„„„ „r„ƒ„u „†„…„~„{„ˆ„y„y -
„„„„€ „r„€„ƒ„„€„|„„x„€„r„p„„„„ƒ„‘ [„ƒ„{„‚„y„„„„€„} „t„|„‘ „€„q„~„€„r„|„u„~„y„‘ „t„€ 2.0](upgrade.md).

### „@„{„„„y„r„~„„z Eager execution

„B TensorFlow 1.X „€„„ „„€„|„„x„€„r„p„„„u„|„‘ „„„‚„u„q„€„r„p„|„€„ƒ„ „r„‚„…„‰„~„…„ „ƒ„„„‚„€„y„„„
[„p„q„ƒ„„„‚„p„{„„„~„€„u „ƒ„y„~„„„p„{„ƒ„y„‰„u„ƒ„{„€„u „t„u„‚„u„r„€](https://ru.wikipedia.org/wiki/%D0%90%D0%B1%D1%81%D1%82%D1%80%D0%B0%D0%BA%D1%82%D0%BD%D0%BE%D0%B5_%D1%81%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE) („s„‚„p„†) „„‚„y „„€„}„€„‹„y API „r„„x„€„r„€„r `tf.*`. „D„|„‘ „„„„€„s„€ „q„„|„€ „~„…„w„~„€ „r„‚„…„‰„~„…„
„{„€„}„„y„|„y„‚„€„r„p„„„ „t„u„‚„u„r„€, „„u„‚„u„t„p„r„p„‘ „~„p„q„€„‚ „„€„|„…„‰„p„u„}„„‡ „y „r„‡„€„t„‘„‹„y„‡ „„„u„~„x„€„‚„€„r „{ „r„„x„€„r„… 
`session.run()`. TensorFlow 2.0 „„„u„„u„‚„ „r„„„€„|„~„‘„u„„ „r„ƒ„u „€„„u„‚„p„ˆ„y„y „}„s„~„€„r„u„~„~„€ („„„€„‰„~„€
„„„p„{ „w„u, „{„p„{ „y „€„q„„‰„~„„z Python), „r„ƒ„u „s„‚„p„†„ „y „ƒ„u„ƒ„ƒ„y„y „„„u„„u„‚„ „q„…„t„…„„ „‚„p„q„€„„„p„„„ „{„p„{
„ƒ„„„p„~„t„p„‚„„„~„€„u „r„„„€„|„~„u„~„y„u „€„„u„‚„p„ˆ„y„z.

„Q„p„~„„Š„u „„€„q„€„‰„~„„} „„‚„€„t„…„{„„„€„} eager execution „q„„| „}„u„„„€„t `tf.control_dependencies()`,
„{„€„„„€„‚„„z „„„u„„u„‚„ „~„u „„„‚„u„…„q„u„„„ƒ„‘, „y „r„ƒ„u „ƒ„„„‚„€„{„y „{„€„t„p „q„…„t„…„„ „y„ƒ„„€„|„~„‘„„„„ƒ„‘ „r „„€„ƒ„|„u„t„€„r„p„„„u„|„„~„€„}
„„€„‚„‘„t„{„u, „€„„‚„u„t„u„|„u„~„~„€„} `tf.function`. „R„„„€„‚„€„~„~„y„z „{„€„t „q„…„t„u„„ „r„„„€„|„~„‘„„„„ƒ„‘ „r 
„€„„‚„u„t„u„|„u„~„~„€„} „u„}„… „„€„‚„‘„t„{„u.

### „N„y„{„p„{„y„‡ „s„|„€„q„p„|„„~„„‡ „„u„‚„u„}„u„~„~„„‡

TensorFlow 1.X „r„~„…„„„‚„u„~„~„u „„€„|„p„s„p„|„ƒ„‘ „~„p „s„|„€„q„p„|„„~„„u „„u„‚„u„}„u„~„~„„u. „K„€„s„t„p „r„ „r„„x„„r„p„|„y
`tf.Variable()`, „„„€ „„„„p „„u„‚„u„}„u„~„~„p„‘ „„€„}„u„‹„p„|„p„ƒ„ „r „ƒ„„„p„~„t„p„‚„„„~„„z „s„‚„p„† „y „€„ƒ„„„p„r„p„|„p„ƒ„ „„„p„}
„t„p„w„u „u„ƒ„|„y „…„w„u „q„„|„€ „y„x„}„u„~„u„~„€ „y„}„‘, „„‚„y„ƒ„r„€„u„~„~„€„u „„„„€„z „„u„‚„u„}„u„~„~„€„z. „B„ „}„€„s„|„y „r„€„ƒ„ƒ„„„p„~„€„r„y„„„
„„„„… „„u„‚„u„}„u„~„~„…„ `tf.Variable`, „~„€ „„„€„|„„{„€ „u„ƒ„|„y „„„u„q„u „q„„|„€ „y„x„r„u„ƒ„„„~„€ „y„}„‘, „{„€„„„€„‚„€„u „q„„|„€
„„‚„y„ƒ„r„€„u„~„€ „u„z „„‚„y „ƒ„€„x„t„p„~„y„y. „B „‚„u„x„…„|„„„„p„„„u „r„ƒ„u „}„u„‡„p„~„y„x„}„ „q„„|„y „~„p„„‚„p„r„|„u„~„ „~„p „„„€, „‰„„„€„q„
„„€„}„€„‰„ „„€„|„„x„€„r„p„„„u„|„ „€„„„„ƒ„{„p„„„ „y„}„‘ „y„‡ „„u„‚„u„}„u„~„~„„‡ „u„‹„u „‚„p„x: `tf.get_global_step()`, 
`tf.global_variables_initializer()`, „€„„„„y„}„y„x„p„„„€„‚„, „{„€„„„€„‚„„u „‚„p„ƒ„ƒ„‰„y„„„„r„p„|„y
„s„‚„p„t„y„u„~„„„ „„€ „r„ƒ„u„} „€„q„…„‰„p„u„}„„} „„u„‚„}„u„~„~„„} „y „„„p„{ „t„p„|„u„u. „B TensorFlow 2.0 „„„„y „}„u„‡„p„~„y„x„}„ „q„„|„y
„…„ƒ„„„‚„p„~„u„~„ ([„P„u„‚„u„}„u„~„~„„u 2.0 RFC](https://github.com/tensorflow/community/pull/11))
„r „„€„|„„x„… „~„€„r„€„s„€: „ƒ„|„u„t„y „x„p „ƒ„€„ƒ„„„€„‘„~„y„u„} „‚„p„q„€„‰„y„‡ „„u„‚„u„}„u„~„~„„‡! „E„ƒ„|„y „r„ „„€„„„u„‚„‘„u„„„u `tf.Variable`
(„~„p„„‚„y„}„u„‚, „u„z „q„…„t„u„„ „„‚„y„ƒ„r„€„u„~„€ „~„€„r„€„u „y„}„‘), „„„€ „ƒ„„„p„‚„p„‘ „q„…„t„u„„ „…„t„p„|„u„~„p „y„x „„p„}„‘„„„y „r „„€„‚„‘„t„{„u
„„‚„€„ˆ„u„ƒ„ƒ„p garbage collection.

„S„‚„u„q„€„r„p„~„y„u „ƒ„|„u„t„y„„„ „x„p „„u„‚„u„}„u„~„~„„}„y „ƒ„€„x„t„p„u„„ „t„€„„€„|„~„y„„„u„|„„~„…„ „~„p„s„‚„…„x„{„… „~„p „„€„|„„x„€„r„p„„„u„|„‘,
„~„€ „r „ƒ„|„…„‰„p„u „ƒ „€„q„Œ„u„{„„„p„}„y Keras („ƒ„}. „~„y„w„u), „„„„€ „~„p„s„‚„…„x„{„p - „}„y„~„y„}„p„|„„~„p„‘.

### „U„…„~„{„ˆ„y„y, „p „~„u „ƒ„u„ƒ„ƒ„y„y

„B„„x„€„r `session.run()` „‚„p„q„€„„„p„| „„€„‰„„„y „{„p„{ „r„„x„€„r „†„…„~„{„ˆ„y„y: „r„ „€„„‚„u„t„u„|„‘„|„y „r„r„€„t„~„„u „t„p„~„~„„u
„y „r„„x„„r„p„| „†„…„~„{„ˆ„y„, „„€„|„…„‰„p„‘ „~„p „r„„‡„€„t„u „‚„u„x„…„|„„„„p„„„. „B TensorFlow 2.0, „r„ „}„€„w„u„„„u
„t„u„{„€„‚„y„‚„€„r„p„„„ „†„…„~„{„ˆ„y„ Python „„‚„y „„€„}„€„‹„y `tf.function()`, „€„„„}„u„„„y„r „u„v „{„p„{ JIT-„{„€„}„„y„|„y„‚„…„u„}„…„,
„‰„„„€„q„ TensorFlow „x„p„„…„ƒ„„„y„| „u„u „~„p „€„t„~„€„} „u„t„y„~„ƒ„„„r„u„~„~„€„} „s„‚„p„†„u
([„U„…„~„{„ˆ„y„y 2.0 RFC](https://github.com/tensorflow/community/pull/20)). „^„„„€„„
„}„u„‡„p„~„y„x„} „„€„x„r„€„|„‘„u„„ TensorFlow 2.0 „„€„|„…„‰„y„„„ „r„ƒ„u „„‚„u„y„}„…„‹„u„ƒ„„„r„p „‚„u„w„y„}„p graph:

-   „P„‚„€„y„x„r„€„t„y„„„u„|„„~„€„ƒ„„„: „†„…„~„{„ˆ„y„y „}„€„s„…„„ „q„„„„ „€„„„„y„}„y„x„y„‚„€„r„p„~„ („€„„„ƒ„u„‰„u„~„y„u „…„x„|„€„r „s„‚„p„†„p,
    „ƒ„|„y„‘„~„y„u „‘„t„‚„p „y „„„p„{ „t„p„|„u„u)
-   „P„€„‚„„„p„„„y„r„~„€„ƒ„„„: „U„…„~„{„ˆ„y„y „}„€„s„…„„ „q„„„„ „„{„ƒ„„€„‚„„„y„‚„€„r„p„~„
    „y„|„y „y„}„„€„‚„„„y„‚„€„r„p„~„ „„€„r„„„€„‚„~„€ ([„R„€„‡„‚„p„~„u„~„y„u „}„€„t„u„|„u„z 2.0 RFC](https://github.com/tensorflow/community/pull/34)),
    „„€„x„r„€„|„‘„‘ „„€„|„„x„€„r„p„„„u„|„‘„} „y„ƒ„„€„|„„x„€„r„p„„„ „}„€„t„…„|„„~„„u „†„…„~„{„ˆ„y„y TensorFlow „y „t„u„|„y„„„„ƒ„‘ „y„}„y.

```python
# TensorFlow 1.X
outputs = session.run(f(placeholder), feed_dict={placeholder: input})
# TensorFlow 2.0
outputs = f(input)
```

„R „~„€„r„€„z „r„€„x„}„€„w„~„€„ƒ„„„„ „„‚„€„ƒ„„„€ „y„ƒ„„€„|„„x„€„r„p„„„ „r„}„u„ƒ„„„u „{„€„t Python „y TensorFlow, „}„ „€„w„y„t„p„u„}
„‰„„„€ „„€„|„„x„€„r„p„„„u„|„y „r„€„ƒ„„€„|„„x„…„„„„ƒ„‘ „r„ƒ„u„}„y „„‚„u„y„}„…„‹„u„ƒ„„„r„p„}„y „r„„‚„p„x„y„„„u„|„„~„€„ƒ„„„y „‘„x„„{„p Python.
„N„€ „„€„‚„„„p„„„y„r„~„„z TensorFlow „r„„„€„|„~„‘„u„„ „€„„u„‚„p„ˆ„y„y „r „€„{„‚„…„w„u„~„y„y „q„u„x „y„~„„„u„‚„„‚„u„„„p„„„€„‚„p Python -
„~„p „}„€„q„y„|„„~„„‡ „…„ƒ„„„‚„€„z„ƒ„„„r„p„‡, C++ „y JavaScript. „X„„„€„q„ „„€„}„€„‰„ „„€„|„„x„€„r„p„„„u„|„‘„} „|„u„s„{„€ „„u„‚„u„„y„ƒ„p„„„
„ƒ„r„€„z „{„€„t „„‚„y „y„ƒ„„€„|„„x„€„r„p„~„y„y „~„€„r„€„z `@tf.function`, „y„ƒ„„€„|„„x„…„z [AutoGraph](autograph.ipynb)
„t„|„‘ „{„€„~„r„u„‚„„„p„ˆ„y„y „{„€„t„p Python „r „y„‡ „„{„r„y„r„p„|„u„~„„„ TensorFlow:

*   `print` -> `tf.print`
*   `assert` -> `tf.Assert`
*   `for`/`while` -> `tf.while_loop` („„€„t„t„u„‚„w„y„r„p„„„„ƒ„‘ `break` „y `continue`)
*   `if` -> `tf.cond`
*   `for _ in dataset` -> `dataset.reduce`

AutoGraph „„€„t„t„u„‚„w„y„r„p„u„„ „r„|„€„w„u„~„~„„u „†„…„~„{„ˆ„y„y „r „„€„‚„‘„t„{„u „r„„„€„|„~„u„~„y„‘ „„‚„€„s„‚„p„}„}„, „‰„„„€
„t„u„|„p„u„„ „r„€„x„}„€„w„~„„} „„‚„€„y„x„r„€„t„y„„„u„|„„~„€ „y „„„€„‰„~„€ „r„~„u„t„‚„‘„„„ „{„€„}„„|„u„{„ƒ„~„„u „„‚„€„s„‚„p„}„}„
„}„p„Š„y„~„~„€„s„€ „€„q„…„‰„u„~„y„‘, „~„p„„‚„y„}„u„‚ „„„p„{„y„u „{„p„{ „„€„ƒ„|„u„t„€„r„p„„„u„|„„~„„u „}„€„t„u„|„y, „€„q„…„‰„u„~„y„u „ƒ
„„€„t„{„‚„u„„|„u„~„y„u„}, „ƒ„€„q„ƒ„„„r„u„~„~„„u „ˆ„y„{„|„ „€„q„…„‰„u„~„y„‘ „y „}„~„€„s„y„u „t„‚„…„s„y„u.

## „Q„u„{„€„}„u„~„t„p„ˆ„y„y „y „y„t„y„€„}„ TensorFlow 2.0

### „Q„u„†„p„{„„„€„‚„y„~„s „{„€„t„p „~„p „}„p„|„„u „†„…„~„{„ˆ„y„y

„X„p„ƒ„„„€ „y„ƒ„„€„|„„x„…„u„}„„z „Š„p„q„|„€„~ „y„ƒ„„€„|„„x„€„r„p„~„y„‘ „r TensorFlow 1.X „‚„p„q„€„„„p„| „„€ „„‚„y„~„ˆ„y„„…
kitchen sink ("„{„…„‡„€„~„~„€„z „‚„p„{„€„r„y„~„"), „{„€„s„t„p „q„„p „r„„|„€„w„u„~„p „ƒ„€„r„€„{„…„„~„€„ƒ„„„ „r„ƒ„u„‡ „r„€„x„}„€„w„~„„‡ „r„„‰„y„ƒ„|„u„~„y„z,
„p „x„p„„„u„} „r„„q„‚„p„~„~„„u „„„u„~„x„€„‚„ „r„„‰„y„ƒ„|„‘„|„y„ƒ„ „ƒ „„€„}„€„‹„„ `session.run()`. „B TensorFlow 2.0
„„€„|„„x„€„r„p„„„u„|„y „t„€„|„w„~„ „ƒ„p„}„y „‚„p„x„q„y„r„p„„„ „{„€„t „~„p „q„€„|„u„u „}„u„|„{„y„u „†„…„~„{„ˆ„y„y „y „r„„x„„r„p„„„ „{„p„w„t„…„
„{„€„s„t„p „„„„€ „~„u„€„q„‡„€„t„y„}„€. „N„u„€„q„‘„x„p„„„u„|„„~„€ „t„u„{„€„‚„y„‚„€„r„p„„„ „{„p„w„t„…„ „y„x „„„„y„‡ „~„u„q„€„|„„Š„y„‡ „†„…„~„{„ˆ„y„z
„ƒ `tf.function`; „y„ƒ„„€„|„„x„…„z `tf.function` „t„|„‘ „t„u„{„€„‚„y„‚„€„r„p„~„y„‘ „„„€„|„„{„€ „r„„ƒ„€„{„€„…„‚„€„r„~„u„r„„‡
„r„„‰„y„ƒ„|„u„~„y„z - „~„p„„‚„y„}„u„‚, „€„t„y„~ „Š„p„s „€„q„…„‰„u„~„y„‘ „y„|„y „„‚„‘„}„€„s„€ „„‚„€„‡„€„t„p „t„|„‘ „}„€„t„u„|„y.

### „I„ƒ„„€„|„„x„…„z „ƒ„|„€„y „y „}„€„t„u„|„y Keras „t„|„‘ „…„„‚„p„r„|„u„~„y„‘ „„u„‚„u„}„u„~„~„„}„y

„M„€„t„u„|„y „y „ƒ„|„€„y Keras „„‚„u„t„|„p„s„p„„„ „y„ƒ„„€„|„„x„€„r„p„„„ „…„t„€„q„~„€„u „ƒ„r„€„z„ƒ„„„r„€ `.variables`, „{„€„„„€„‚„€„u
„‚„u„{„…„‚„ƒ„y„r„~„€ „ƒ„€„q„y„‚„p„u„„ „r„ƒ„u „x„p„r„y„ƒ„y„}„„u „„u„‚„u„}„u„~„~„„u. „^„„„€ „x„~„p„‰„y„„„u„|„„~„€ „€„q„|„u„s„‰„p„u„„ „|„€„{„p„|„„~„€„u „…„„‚„p„r„|„u„~„y„u
„„u„‚„u„}„u„~„~„„}„y.

„R„‚„p„r„~„y„„„u:

```python
def dense(x, W, b):
  return tf.nn.sigmoid(tf.matmul(x, W) + b)

@tf.function
def multilayer_perceptron(x, w0, b0, w1, b1, w2, b2 ...):
  x = dense(x, w0, b0)
  x = dense(x, w1, b1)
  x = dense(x, w2, b2)
  ...

# „N„p„} „r„ƒ„u „‚„p„r„~„€ „„‚„y„t„u„„„ƒ„‘ „…„„‚„p„r„|„‘„„„ w_i „y b_i, „„„p„{ „{„p„{ „y„‡ „†„€„‚„}„ „€„„‚„u„t„u„|„‘„„„„ƒ„‘ „~„u „r „{„€„t„u.
```

„B„u„‚„ƒ„y„‘ „ƒ „y„ƒ„„€„|„„x„€„r„p„~„y„u„} Keras:

```python
# „K„p„w„t„„z „ƒ„|„€„z „}„€„w„u„„ „q„„„„ „r„„x„r„p„~ „ƒ „ƒ„y„s„~„p„„„…„‚„€„z „‚„p„r„~„€„z linear(x)
layers = [tf.keras.layers.Dense(hidden_size, activation=tf.nn.sigmoid) for _ in range(n)]
perceptron = tf.keras.Sequential(layers)

# layers[3].variables => returns [w3, b3]
# perceptron.variables => returns [w0, b0, ...]
```

„M„€„t„u„|„y „y „ƒ„|„€„y Keras „~„p„ƒ„|„u„t„…„„„„ƒ„‘ „y„x `tf.train.Checkpointable` „y „y„~„„„u„s„‚„y„‚„…„„„„ƒ„‘ „ƒ
`@tf.function`, „‰„„„€ „t„u„|„p„u„„ „r„€„x„}„€„w„~„„} „ƒ„€„‡„‚„p„~„y„„„ „y„|„y „~„u„„€„ƒ„‚„u„t„ƒ„„„r„u„~„~„€ „„{„ƒ„„€„‚„„„y„‚„€„r„p„„„
„ƒ„€„‡„‚„p„~„u„~„~„„u „}„€„t„u„|„y „y„x „€„q„Œ„u„{„„„€„r Keras. „N„u„€„q„‘„x„p„„„u„|„„~„€ „y„ƒ„„€„|„„x„€„r„p„„„ „}„u„„„€„t `.fit()` „y„x
Keras API „t„|„‘ „„„„y„‡ „y„~„„„u„s„‚„p„ˆ„y„z.

„B„€„„ „„‚„y„}„u„‚ transfer learning („„u„‚„u„~„€„ƒ„p „€„q„…„‰„u„~„y„‘), „{„€„„„€„‚„„z „t„u„}„€„~„ƒ„„„‚„y„‚„…„u„„ „{„p„{ „|„u„s„{„€
„ƒ„€„q„‚„p„„„ „„€„t„}„~„€„w„u„ƒ„„„r„€ „~„u„€„q„‡„€„t„y„}„„‡ „„u„‚„u„}„u„~„~„„‡ „ƒ „„€„}„€„‹„„ Keras. „P„‚„u„t„„€„|„€„w„y„}, „}„ „€„q„…„‰„p„u„}
„‚„p„x„r„u„„„r„|„u„~„~„…„ (multi-head) „}„€„t„u„|„ „ƒ „€„q„‹„y„} „{„€„‚„~„u„} (trunk):

```python
trunk = tf.keras.Sequential([...])
head1 = tf.keras.Sequential([...])
head2 = tf.keras.Sequential([...])

path1 = tf.keras.Sequential([trunk, head1])
path2 = tf.keras.Sequential([trunk, head2])

# „O„q„…„‰„p„u„} „~„p „€„ƒ„~„€„r„~„€„} „t„p„„„p„ƒ„u„„„u:
for x, y in main_dataset:
  with tf.GradientTape() as tape:
    prediction = path1(x)
    loss = loss_fn_head1(prediction, y)
  # „O„t„~„€„r„‚„u„}„u„~„~„€ „€„„„„y„}„y„x„y„‚„…„u„} „{„€„‚„u„~„ „y „r„u„ƒ„p „„u„‚„r„€„z „r„u„„„r„y:
  gradients = tape.gradients(loss, path1.variables)
  optimizer.apply_gradients(gradients, path1.variables)

# „N„p„ƒ„„„‚„p„y„r„p„u„} „r„„„€„‚„…„ „r„u„„„r„, „„€„r„„„€„‚„~„€ „y„ƒ„„€„|„„x„…„‘ „{„€„‚„u„~„:
for x, y in small_dataset:
  with tf.GradientTape() as tape:
    prediction = path2(x)
    loss = loss_fn_head2(prediction, y)
  # „O„„„„y„}„y„x„y„‚„…„u„} „r„u„ƒ„p „„„€„|„„{„€ „r„„„€„‚„€„z „r„u„„„r„y, „q„u„x „r„u„ƒ„€„r „{„€„‚„~„‘:
  gradients = tape.gradients(loss, head2.variables)
  optimizer.apply_gradients(gradients, head2.variables)

# 
# „M„€„w„u„} „ƒ„€„‡„‚„p„~„y„„„ „r„„‰„y„ƒ„|„u„~„y„‘ „{„€„‚„~„‘, „‰„„„€„q„ „t„‚„…„s„y„u „„„p„{„w„u „}„€„s„|„y „y„} „r„€„ƒ„„€„|„„x„€„r„p„„„„ƒ„‘.
tf.saved_model.save(trunk, output_path)
```

### „O„q„Œ„u„t„y„~„u„~„y„u tf.data.Datasets „y @tf.function

„P„‚„y „€„q„…„‰„u„~„y„y „}„€„t„u„|„y „~„p „t„p„~„~„„‡, „{„€„„„€„‚„„u „~„p„‡„€„t„‘„„„ƒ„‘ „r „„p„}„‘„„„y, „y„ƒ„„€„|„„x„…„z „ƒ„„„p„~„t„p„‚„„„~„„z
„y„„„u„‚„p„„„€„‚ Python. „B „€„ƒ„„„p„|„„~„„‡ „ƒ„|„…„‰„p„‘„‡ `tf.data.Dataset` „‘„r„|„‘„u„„„ƒ„‘ „|„…„‰„Š„y„} „ƒ„„€„ƒ„€„q„€„}
„t„|„‘ „„€„„„€„{„p „„„‚„u„~„y„‚„€„r„€„‰„~„„‡ „t„p„~„~„„‡ „ƒ „t„y„ƒ„{„p. „D„p„„„p„ƒ„u„„„ „‘„r„|„‘„„„„ƒ„‘
[„y„„„u„‚„y„‚„…„u„}„„}„y („~„u „y„„„u„‚„p„„„€„‚„p„}„y)](https://docs.python.org/3/glossary.html#term-iterable),
„y „‚„p„q„€„„„p„„„ „„„p„{ „w„u, „{„p„{ „y „t„‚„…„s„y„u „y„„„u„‚„p„„„€„‚„ Python „r „‚„u„w„y„}„u Eager. „B„ „}„€„w„u„„„u „~„p„y„q„€„|„u„u
„„€„|„~„€ „y„ƒ„„€„|„„x„€„r„p„„„ „p„ƒ„y„~„‡„‚„€„~„~„„u „r„€„x„}„€„w„~„€„ƒ„„„y prefetch „y stream „„‚„y „„€„}„€„‹„y
`tf.function()`, „{„€„„„€„‚„p„‘ „x„p„}„u„~„‘„u„„ „y„„„u„‚„p„ˆ„y„y Python „y„‡ „„{„r„y„r„p„|„u„~„„„p„}„y „€„„u„‚„p„ˆ„y„z „s„‚„p„†„€„r
„„€„ƒ„‚„u„t„ƒ„„„r„€„} AutoGraph.

```python
@tf.function
def train(model, dataset, optimizer):
  for x, y in dataset:
    with tf.GradientTape() as tape:
      prediction = model(x)
      loss = loss_fn(prediction, y)
    gradients = tape.gradients(loss, model.variables)
    optimizer.apply_gradients(gradients, model.variables)
```

„E„ƒ„|„y „r„ „y„ƒ„„€„|„„x„…„u„„„u „}„u„„„€„t `.fit()` „y„x Keras API, „„„€ „r„p„} „~„u „„‚„y„t„u„„„ƒ„‘
„r„€„|„~„€„r„p„„„„ƒ„‘ „€„q „y„„„u„‚„p„ˆ„y„y „t„p„„„p„ƒ„u„„„p.

```python
model.compile(optimizer=optimizer, loss=loss_fn)
model.fit(dataset)
```

### „B„€„ƒ„„€„|„„x„…„z„„„u„ƒ„ „„‚„u„}„y„…„‹„u„ƒ„„„r„p„}„y AutoGraph „ƒ „„€„‚„‘„t„{„€„} „r„„„€„|„~„u„~„y„‘ Python

AutoGraph „€„q„u„ƒ„„u„‰„y„r„p„u„„ „ƒ„„€„ƒ„€„q „{„€„~„r„u„‚„„„p„ˆ„y„y „x„p„r„y„ƒ„y„}„€„s„€ „€„„ „t„p„~„~„„‡ „„€„‚„‘„t„{„p
„r„„„€„|„~„u„~„y„‘ „r „u„s„€ „„{„r„y„r„p„|„u„~„„„ „r „‚„u„w„y„}„u graph, „~„p„„‚„y„}„u„‚ `tf.cond` „y `tf.while_loop`.

„E„t„y„~„ƒ„„„r„u„~„~„€„u „}„u„ƒ„„„€, „s„t„u „„€„‘„r„|„‘„u„„„ƒ„‘ „x„p„r„y„ƒ„y„}„„z „€„„ „t„p„~„~„„‡ „„€„‚„‘„t„€„{ „r„„„€„|„~„u„~„y„‘ „„„„€
„„€„ƒ„|„u„t„€„r„p„„„u„|„„~„„u „}„€„t„u„|„y. `tf.keras.layers.RNN` „y„ƒ„„€„|„„x„…„u„„ „„|„u„}„u„~„„ RNN, „„€„x„r„€„|„‘„‘
„r„p„} „‚„p„x„r„u„‚„~„…„„„ „„€„r„„„€„‚ „ƒ„„„p„„„y„‰„u„ƒ„{„y „y„|„y „t„y„~„p„}„y„‰„u„ƒ„{„y. „D„|„‘ „„‚„y„}„u„‚„p, „r„ „}„€„w„u„„„u
„y„ƒ„„€„|„„x„€„r„p„„„ „t„y„~„p„}„y„‰„u„ƒ„{„€„u „‚„p„x„r„u„‚„„„„r„p„~„y„u:

```python
class DynamicRNN(tf.keras.Model):

  def __init__(self, rnn_cell):
    super(DynamicRNN, self).__init__(self)
    self.cell = rnn_cell

  def call(self, input_data):
    # [„q„p„„„‰, „r„‚„u„}„‘, „„p„‚„p„}„u„„„‚„] -> [„r„‚„u„}„‘, „q„p„„„‰, „„p„‚„p„}„u„„„‚„]
    input_data = tf.transpose(input_data, [1, 0, 2])
    outputs = tf.TensorArray(tf.float32, input_data.shape[0])
    state = self.cell.zero_state(input_data.shape[1], dtype=tf.float32)
    for i in tf.range(input_data.shape[0]):
      output, state = self.cell(input_data[i], state)
      outputs = outputs.write(i, output)
    return tf.transpose(outputs.stack(), [1, 0, 2]), state
```

„D„|„‘ „q„€„|„u„u „t„u„„„p„|„„~„€„s„€ „€„„y„ƒ„p„~„y„u „r„€„x„}„€„w„~„€„ƒ„„„u„z AutoGraph „€„x„~„p„{„€„}„„„„u„ƒ„ „ƒ
[„‚„…„{„€„r„€„t„ƒ„„„r„€„}](./autograph.ipynb).

### „I„ƒ„„€„|„„x„…„z„„„u tf.metrics „t„|„‘ „ƒ„q„€„‚„p „t„p„~„~„„‡ „y tf.summary „t„|„‘ „|„€„s„€„r

„D„|„‘ „x„p„„y„ƒ„y „|„€„s„€„r, „y„ƒ„„€„|„„x„…„z„„„u `tf.summary.(scalar|histogram|...)`. „E„ƒ„|„y „y„ƒ„„€„|„„x„€„r„p„„„
„t„p„~„~„„u „}„u„„„€„t„ „€„„„t„u„|„„~„€, „„„€ „€„~„y „~„u „q„…„t„…„„ „~„y„‰„u„s„€ „t„u„|„p„„„; „‚„u„x„…„|„„„„p„„„ „t„€„|„w„~„ „q„„„„
„„u„‚„u„~„p„„‚„p„r„|„u„~„ „{ „ƒ„€„€„„„r„u„„„ƒ„„„r„…„„‹„u„}„… file writer, „„‚„y „„€„}„€„‹„y „{„€„~„„„u„{„ƒ„„„~„€„s„€ „}„u„~„u„t„w„u„‚„p
(„„„„€ „„€„x„r„€„|„y„„ „r„p„} „y„x„q„u„w„p„„„ „x„p„„y„ƒ„y „|„€„s„€„r „r file writer).

```python
summary_writer = tf.summary.create_file_writer('/tmp/summaries')
with summary_writer.as_default():
  tf.summary.scalar('loss', 0.1, step=42)
```

„X„„„€„q„ „ƒ„€„q„‚„p„„„ „t„p„~„~„„u „„u„‚„u„t „x„p„„y„ƒ„„ „r „|„€„s, „y„ƒ„„€„|„„x„…„z„„„u `tf.metrics`. „M„u„„„‚„y„{„y
„ƒ„€„‡„‚„p„~„‘„„„ „ƒ„r„€„u „ƒ„€„ƒ„„„€„‘„~„y„u; „€„~„y „~„p„{„p„„|„y„r„p„„„ „x„~„p„‰„u„~„y„‘ „y „r„€„x„r„‚„p„‹„p„„„ „ƒ„€„q„y„‚„p„„„u„|„„~„„z 
„‚„u„x„…„|„„„„p„„, „{„€„s„t„p „r„ „r„„x„„r„p„u„„„u „}„u„„„€„t `.result()`. „X„„„€„q„ „€„‰„y„ƒ„„„y„„„ „r„ƒ„u „x„~„p„‰„u„~„y„‘ 
„y„ƒ„„€„|„„x„…„z„„„u „}„u„„„€„t `.reset_states()`.

```python
def train(model, optimizer, dataset, log_freq=10):
  avg_loss = tf.keras.metrics.Mean(name='loss', dtype=tf.float32)
  for images, labels in dataset:
    loss = train_step(model, optimizer, images, labels)
    avg_loss.update_state(loss)
    if tf.equal(optimizer.iterations % log_freq, 0):
      tf.summary.scalar('loss', avg_loss.result(), step=optimizer.iterations)
      avg_loss.reset_states()

def test(model, test_x, test_y, step_num):
  loss = loss_fn(model(test_x), test_y)
  tf.summary.scalar('loss', loss, step=step_num)

train_summary_writer = tf.summary.create_file_writer('/tmp/summaries/train')
test_summary_writer = tf.summary.create_file_writer('/tmp/summaries/test')

with train_summary_writer.as_default():
  train(model, optimizer, dataset)

with test_summary_writer.as_default():
  test(model, test_x, test_y, optimizer.iterations)
```

„T„{„p„x„p„r „„p„„{„… „ƒ „‚„u„x„…„|„„„„p„}„y „r TensorBoard (`tensorboard --logdir
/tmp/summaries`), „r„ „}„€„w„u„„„u „r„y„x„…„p„|„y„x„y„‚„€„r„p„„„ „„€„|„…„‰„u„~„~„„u „r „‡„€„t„u „€„q„…„‰„u„~„y„‘
„t„p„~„~„„u „~„p „s„‚„p„†„y„{„p„‡.


